<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using ggforestplot • ggforestplot</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using ggforestplot">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggforestplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://nightingalehealth.com">Nightingale Health</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/NgaleHealth">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/nightingalehealth">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using ggforestplot</h1>
                        <h4 class="author">Nightingale Health Ltd.</h4>
            
            <h4 class="date">2019-03-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nightingalehealth/ggforestplot/blob/master/vignettes/ggforestplot.Rmd"><code>vignettes/ggforestplot.Rmd</code></a></small>
      <div class="hidden name"><code>ggforestplot.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The R package <code>ggforestplot</code> allows to plot vertical <a href="https://en.wikipedia.org/wiki/Forest_plot">forest plots</a>, a.k.a. blobbograms, and it’s based on <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a>.</p>
<p>In this tutorial we will go through its basic functionality, as well as how one can produce grouped plots, using demo data from <a href="https://nightingalehealth.com/technology">Nightingale’s NMR platform</a>.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install <code>ggforestplot</code> from github as shown below (unless already installed, you need to install <code>devtools</code> first):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"NightingaleHealth/ggforestplot"</span>)</code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The main plotting function is <code><a href="../reference/forestplot.html">ggforestplot::forestplot()</a></code>. It’s main input is a data frame that contains the values and corresponding standard errors to be plotted in a forestplot layout.</p>
<p>Let’s get right to it and plot an example before with delve into the details of the input parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load and attach the package</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggforestplot)

<span class="co"># Load and attach other useful packages</span>
<span class="co"># install.packages("tidyverse")</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)

<span class="co"># Filter only associations to BMI for the first 30 biomarkers of the example </span>
<span class="co"># dataset</span>
df &lt;-
<span class="st">  </span>ggforestplot<span class="op">::</span>df_linear_associations <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(
    trait <span class="op">==</span><span class="st"> "BMI"</span>,
    dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>
  )

<span class="co"># Draw a forestplot of cross-sectional, linear associations </span>
ggforestplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggforestplot/topics/forestplot">forestplot</a></span>(
  <span class="dt">df =</span> df, 
  <span class="dt">name =</span> name, 
  <span class="dt">estimate =</span> beta,
  <span class="dt">se =</span> se
)</code></pre></div>
<p><img src="ggforestplot_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>These are the linear associations of BMI to 30 blood biomarkers - selected somewhat randomly - along with their 95% confidence intervals.</p>
<p>Now let’s take a closer look at the example dataset used above in order to understand what is the input that <code><a href="../reference/forestplot.html">ggforestplot::forestplot()</a></code> expects.</p>
<p>The dataset <code><a href="../reference/df_linear_associations.html">ggforestplot::df_linear_associations</a></code> is a <a href="https://tibble.tidyverse.org/"><code>tibble()</code></a> and contains linear associations of blood biomarkers to Body Mass Index (BMI), insulin resistance (log(HOMA-IR)) and fasting glucose as found in <a href="https://www.biorxiv.org/content/early/2019/01/08/513648">A. V. Ahola-Olli et al. (2019)</a>. Below are the first 10 rows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Linear associations of blood biomarkers to Body Mass Index (BMI), insulin </span>
<span class="co"># resistance (log(HOMA-IR)) and fasting glucose</span>
ggforestplot<span class="op">::</span>df_linear_associations <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>()
<span class="co">#&gt; # A tibble: 681 x 5</span>
<span class="co">#&gt;    name          trait    beta      se    pvalue</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Isoleucine    BMI    0.339  0.00945 1.11e-281</span>
<span class="co">#&gt;  2 Leucine       BMI    0.343  0.00951 1.25e-285</span>
<span class="co">#&gt;  3 Valine        BMI    0.287  0.00951 7.94e-200</span>
<span class="co">#&gt;  4 Phenylalanine BMI    0.343  0.00862 0.       </span>
<span class="co">#&gt;  5 Tyrosine      BMI    0.261  0.00900 6.65e-185</span>
<span class="co">#&gt;  6 Alanine       BMI    0.179  0.00890 8.62e- 90</span>
<span class="co">#&gt;  7 Glutamine     BMI   -0.134  0.00945 7.68e- 46</span>
<span class="co">#&gt;  8 Glycine       BMI   -0.0296 0.00937 1.56e-  3</span>
<span class="co">#&gt;  9 Histidine     BMI    0.0364 0.00917 7.25e-  5</span>
<span class="co">#&gt; 10 Lactate       BMI    0.131  0.00911 9.20e- 47</span>
<span class="co">#&gt; # … with 671 more rows</span></code></pre></div>
<p>The variables, as also stated in the documentation, are:</p>
<ul>
<li>
<code>name</code>: the names of the Nightingale serum biomarkers (Note: glucose is missing as the results are adjusted for this biomarker).</li>
<li>
<code>trait</code>: the response variable of the regression model, BMI, log(HOMA-IR) or fasting glucose.</li>
<li>
<code>beta</code>: regression coefficient <span class="math inline">\(\beta\)</span>.</li>
<li>
<code>se</code>: standard deviation</li>
<li>
<code>pvalue</code>: p-value</li>
</ul>
<p>So the first input parameter for <code><a href="../reference/forestplot.html">forestplot()</a></code> must be a data frame with at least the variables <code>name</code> (character), <code>estimate</code> (numeric) and <code>se</code> (numeric), which of course may be named differently.</p>
<div id="adding-information-on-statistical-significance" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-information-on-statistical-significance" class="anchor"></a>Adding information on statistical significance</h3>
<p>Let’s now start improving the plot above.</p>
<p>First, we need a more descriptive x axis label and we may also add a title. We’d also like to visualize a Bonferroni correction to account for multiple testing. Here we have a comparison of 30 biomarkers. If we suppose the common significance threshold <span class="math inline">\(\alpha = 0.05\)</span>, the Bonferroni correction for each individual hypothesis, assuming the 30 tests are independent, is <span class="math inline">\(\alpha = 0.05 / 30 \approx 0.002\)</span> (Note: in fact for biologically correlated measures this correction is too strict; here we could, for example, perform a principal component analysis and instead of the number of biomarkers we’d choose the number of principal components that explain a fair amount of variance in the metabolic data, e.g. 99%; see also <code><a href="../articles/nmr-data-analysis-tutorial.html">vignette("nmr-data-analysis-tutorial")</a></code>.</p>
<p>In the forestplot function, we will input the significance threshold as the parameter <code>psignif</code> and we will define explicitly the variable name in <code>df</code> that contains the p-values of the linear regression, in this case the column <code>pvalue</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Draw a forestplot of cross-sectional, linear associations </span>
<span class="co"># Add a more descriptive x-label, a title and the threshold for statistical </span>
<span class="co"># significance with Bonferroni correction. </span>
<span class="co"># (Note that the df variable names 'name', 'beta' and 'se' do not really have to be </span>
<span class="co"># explictly defined, as these are the default input values of these parameters.)</span>
ggforestplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggforestplot/topics/forestplot">forestplot</a></span>(
  <span class="dt">df =</span> df, 
  <span class="dt">estimate =</span> beta,
  <span class="dt">pvalue =</span> pvalue,
  <span class="dt">psignif =</span> <span class="fl">0.002</span>,
  <span class="dt">xlab =</span> <span class="st">"1-SD increment in BMI</span><span class="ch">\n</span><span class="st">per 1-SD increment in biomarker concentration"</span>,
  <span class="dt">title =</span> <span class="st">"Associations of blood biomarkers to BMI"</span>
)</code></pre></div>
<p><img src="ggforestplot_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Notice how the non-significant results are now displayed as hollow points.</p>
</div>
<div id="comparing-several-traits" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-several-traits" class="anchor"></a>Comparing several traits</h3>
<p>Let us now go ahead and plot, along with the BMI, the associations with insulin resistance (HOMA-IR) and fasting glucose.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract the biomarker names</span>
selected_bmrs &lt;-
<span class="st">  </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(name)

<span class="co"># Filter the demo dataset for the biomarkers above and all three traits:</span>
<span class="co"># BMI, HOMA-IR and fasting glucose</span>
df_compare_traits &lt;-<span class="st"> </span>
<span class="st">  </span>ggforestplot<span class="op">::</span>df_linear_associations <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(name <span class="op">%in%</span><span class="st"> </span>selected_bmrs)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Set class to factor to set order of display. </span>
<span class="st">  </span><span class="kw">mutate</span>(
     <span class="dt">trait =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(
     trait, 
     <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"BMI"</span>, <span class="st">"HOMA-IR"</span>, <span class="st">"Fasting glucose"</span>))
  ) 

<span class="co"># Draw a forestplot of cross-sectional, linear associations </span>
<span class="co"># Notice how the df variable 'trait' is used here to color the points</span>
ggforestplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggforestplot/topics/forestplot">forestplot</a></span>(
  <span class="dt">df =</span> df_compare_traits, 
  <span class="dt">estimate =</span> beta,
  <span class="dt">pvalue =</span> pvalue,
  <span class="dt">psignif =</span> <span class="fl">0.002</span>,
  <span class="dt">xlab =</span> <span class="st">"1-SD increment in cardiometabolic trait</span><span class="ch">\n</span><span class="st">per 1-SD increment in biomarker concentration"</span>,
  <span class="dt">title =</span> <span class="st">"Biomarker associations to metabolic traits"</span>,
  <span class="dt">colour =</span> trait
) </code></pre></div>
<p><img src="ggforestplot_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="grouping-the-biomarkers" class="section level3">
<h3 class="hasAnchor">
<a href="#grouping-the-biomarkers" class="anchor"></a>Grouping the biomarkers</h3>
<p>Finally, we would like to group the blood biomarkers by category to improve the readability of the plot.</p>
<p>The package includes also a data frame, <code><a href="../reference/df_NG_biomarker_metadata.html">ggforestplot::df_NG_biomarker_metadata</a></code>, with metadata on the Nightingale blood biomarkers, such as different naming options, descriptions, group/sugroup information and units of measurement. We will use the grouping information in this data frame to plot the 30 biomarkers above in a grouped layout.</p>
<p>We can acheive this by joining the biomarker metadata with the data frame <code>df_compare_traits</code> above, that contains the associations. We will then use a combination of the functions <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::nest()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map2.html">purrr::map2()</a></code> in order to run the forestplot function for each of the groups separately. Finally, we will use the <code><a href="https://www.rdocumentation.org/packages/patchwork/topics/wrap_plots">patchwork::wrap_plots()</a></code> functions to assemble the final forestplot. The steps to do this are shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install and attach the patchwork library</span>
<span class="co"># devtools::install_github("thomasp85/patchwork")</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(patchwork)

<span class="co"># Filter df_NG_biomarker_metadata, that contain the groups, for only the 30 </span>
<span class="co"># biomarkers under discussion</span>
df_grouping &lt;-
<span class="st">  </span>df_NG_biomarker_metadata <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(name <span class="op">%in%</span><span class="st"> </span>df_compare_traits<span class="op">$</span>name)

<span class="co"># Join the association data frame df_compare_traits with group data</span>
df_compare_traits_groups &lt;-
<span class="st">  </span>df_compare_traits <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># use right_join, with df_grouping on the right, to preserve the order of </span>
<span class="st">  </span><span class="co"># biomarkers it specifies. </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">right_join</a></span>(., df_grouping, <span class="dt">by =</span> <span class="st">"name"</span>) 

<span class="co"># Draw a forestplot of cross-sectional, linear associations.</span>
ggplot_multi &lt;-
<span class="st">  </span>df_compare_traits_groups <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>group, <span class="dt">.key =</span> <span class="st">"data"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Apply forestplot to each group </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">gg_groups =</span> purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span>(
      data, group, <span class="op">~</span><span class="st"> </span><span class="kw"><a href="../reference/forestplot.html">forestplot</a></span>(
        <span class="dt">df =</span> .x,
        <span class="dt">estimate =</span> beta,
        <span class="dt">pvalue =</span> pvalue,
        <span class="dt">psignif =</span> <span class="fl">0.002</span>,
        <span class="dt">xlab =</span> <span class="st">"1-SD increment in cardiometabolic trait</span><span class="ch">\n</span><span class="st">per 1-SD increment in biomarker concentration"</span>,
        <span class="dt">colour =</span> trait,
        <span class="dt">title =</span> .y
      ) <span class="op">+</span>
<span class="st">        </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span>(<span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.4</span>))
    ),
    <span class="co"># Optional: remove x-axis and legend for all plots except the bottom one</span>
    <span class="dt">gg_groups =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(
      <span class="dt">test =</span> <span class="kw">row_number</span>() <span class="op">!=</span><span class="st"> </span><span class="kw">n</span>(),
      <span class="dt">yes =</span>
        purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(gg_groups, <span class="op">~</span><span class="st"> </span>. <span class="op">+</span>
<span class="st">          </span><span class="kw">theme</span>(
            <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),
            <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>(),
            <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),
            <span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"mm"</span>)
          ) <span class="op">+</span>
<span class="st">          </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)),
      <span class="dt">no =</span> gg_groups
    ),
    <span class="dt">rel_heights =</span> purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(
      data,  <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(.) 
    ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>()
  )

patchwork<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/patchwork/topics/wrap_plots">wrap_plots</a></span>(
  ggplot_multi<span class="op">$</span>gg_groups,
  <span class="dt">ncol =</span> <span class="dv">1</span>, 
  <span class="dt">heights =</span> ggplot_multi<span class="op">$</span>rel_heights
)</code></pre></div>
<p><img src="ggforestplot_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Notice above, how the order of the biomarkers is now different than in the previous plots. This is the order of groups and biomarkers in <code>df_grouping</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  Print the first 10 rows of df_grouping to inspect the order of biomarkers</span>
df_grouping <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>()
<span class="co">#&gt;  [1] "Total cholines"       "Sphingomyelins"       "Total fatty acids"   </span>
<span class="co">#&gt;  [4] "Unsaturation"         "Omega-3 %"            "Omega-6 %"           </span>
<span class="co">#&gt;  [7] "PUFA %"               "MUFA %"               "SFA %"               </span>
<span class="co">#&gt; [10] "LA %"                 "DHA %"                "Alanine"             </span>
<span class="co">#&gt; [13] "Glutamine"            "Glycine"              "Histidine"           </span>
<span class="co">#&gt; [16] "Isoleucine"           "Leucine"              "Valine"              </span>
<span class="co">#&gt; [19] "Phenylalanine"        "Tyrosine"             "Lactate"             </span>
<span class="co">#&gt; [22] "Pyruvate"             "Citrate"              "Glycerol"            </span>
<span class="co">#&gt; [25] "Acetate"              "Acetoacetate"         "3-hydroxybutyrate"   </span>
<span class="co">#&gt; [28] "Creatinine"           "Albumin"              "Glycoprotein acetyls"</span></code></pre></div>
<p>Another note is that we had to define manually a common axis for all the plots. For that we added the layer <code><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">ggplot2::coord_cartesian(xlim = c(-0.3, 0.4))</a></code> in each <code><a href="../reference/forestplot.html">forestplot()</a></code> call. In order to know, a priori, what is the correct common x limits you are looking for, you need to estimate the confidence intervals from the standard errors. In practice however, you may simply run the above piece of code twice, once without setting x limits and, after visual inspection, rerun adding <code><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">ggplot2::coord_cartesian(xlim = c(xmin, xmax))</a></code>.</p>
<p>Finally, the implementation above removes x-axis texts and labels for each group. You may want to comment that out depending on how long is your column of forestplots but, at least, keep <code>axis.text.x</code> for only the last plot.</p>
</div>
<div id="plotting-odds-hazard-ratios" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-odds-hazard-ratios" class="anchor"></a>Plotting odds / hazard ratios</h3>
<p>The package includes also a second demo dataset from the same paper, <code><a href="../reference/df_logodds_associations.html">ggforestplot::df_logodds_associations</a></code>, with log odds ratios of blood biomarkers with incident type 2 diabetes. The <code>beta</code>, <code>se</code> and <code>pvalue</code> variables in this set are the result of logistic regression and the additonal <code>n</code> variable reports the cohorts sample size.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  Odds Ratios of Blood Biomarkers with Incident Type 2 Diabetes</span>
ggforestplot<span class="op">::</span>df_logodds_associations <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>()
<span class="co">#&gt; # A tibble: 1,135 x 6</span>
<span class="co">#&gt;    name          study            beta     se       pvalue     n</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Isoleucine    Meta-analysis  0.285  0.0500 0.0000000126 11777</span>
<span class="co">#&gt;  2 Leucine       Meta-analysis  0.286  0.0506 0.0000000165 11783</span>
<span class="co">#&gt;  3 Valine        Meta-analysis  0.182  0.0558 0.00110      11777</span>
<span class="co">#&gt;  4 Phenylalanine Meta-analysis  0.271  0.0538 0.000000453  11782</span>
<span class="co">#&gt;  5 Tyrosine      Meta-analysis  0.168  0.0541 0.00189      11779</span>
<span class="co">#&gt;  6 Alanine       Meta-analysis  0.122  0.0540 0.0237       11784</span>
<span class="co">#&gt;  7 Glutamine     Meta-analysis -0.172  0.0575 0.00284      11744</span>
<span class="co">#&gt;  8 Glycine       Meta-analysis -0.0773 0.0617 0.211        11496</span>
<span class="co">#&gt;  9 Histidine     Meta-analysis  0.0473 0.0553 0.393        11777</span>
<span class="co">#&gt; 10 Lactate       Meta-analysis  0.119  0.0529 0.0245       11781</span>
<span class="co">#&gt; # … with 1,125 more rows</span></code></pre></div>
<p>We will use this dataset to demonstrate how to plot odds ratios (the same logic applies for hazard ratios).</p>
<p>The dataset includes log odds ratios with incident type 2 diabetes for a total of 4 cohorts plus the meta-analysis we saw above. Let’s plot the odds ratios for amino acids.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Filter df_NG_biomarker_metadata for only amino acids</span>
df_grouping &lt;-
<span class="st">  </span>df_NG_biomarker_metadata <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(group <span class="op">%in%</span><span class="st"> "Amino acids"</span>) 

<span class="co"># Join the association data frame with group data</span>
df &lt;-
<span class="st">  </span>df_logodds_associations <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Set the study variable to a factor to preserve order of appearance</span>
<span class="st">    </span><span class="kw">mutate</span>(
     <span class="dt">study =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(
     study, 
     <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Meta-analysis"</span>, <span class="st">"NFBC-1997"</span>, <span class="st">"DILGOM"</span>, <span class="st">"FINRISK-1997"</span>, <span class="st">"YFS"</span>))
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># use right_join, with df_grouping on the right, to preserve the order of </span>
<span class="st">  </span><span class="co"># biomarkers it specifies. </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">right_join</a></span>(., df_grouping, <span class="dt">by =</span> <span class="st">"name"</span>) 

<span class="co"># Draw a forestplot of odds ratios</span>
ggforestplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggforestplot/topics/forestplot">forestplot</a></span>(
  <span class="dt">df =</span> df,
  <span class="dt">name =</span> name,
  <span class="dt">estimate =</span> beta,
  <span class="dt">se =</span> se,
  <span class="dt">pvalue =</span> pvalue,
  <span class="dt">psignif =</span> <span class="fl">0.002</span>,
  <span class="dt">colour =</span> study,
  <span class="dt">xlab =</span> <span class="st">"Odds ratio for incident type 2 diabetes (95% CI)</span><span class="ch">\n</span><span class="st">per 1−SD increment in metabolite concentration"</span>,
  <span class="dt">title =</span> <span class="st">"Amino acids"</span>,
  <span class="dt">logodds =</span> <span class="ot">TRUE</span>
)</code></pre></div>
<p><img src="ggforestplot_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Notice that the additional parameter set here is <code>logodds = TRUE</code>. What happens, in this case, is that the <code>beta</code> values are exponentiated and plotted in a logarithmic scale. The confidence intervals for the odds ratios are estimated by default, using the standard errors of the log odds ratios, as follows <span class="math inline">\(\text{CI}_\text{low} = \exp(\beta - 0.95 * \text{SE})\)</span> and <span class="math inline">\(\text{CI}_\text{high} = \exp(\beta - 0.95 * \text{SE})\)</span>. If you wish to use some confidence interval other than the 95%, you may specify this in the parameter <code>ci</code> of the function (see below).</p>
<p>Additionally, you may set a <code>scale_shape_manual()</code>. For example, a common convention is to plot meta-analysis results with a diamond shape.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Draw a forestplot of odds ratios</span>
ggforestplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggforestplot/topics/forestplot">forestplot</a></span>(
  <span class="dt">df =</span> df,
  <span class="dt">name =</span> name,
  <span class="dt">estimate =</span> beta,
  <span class="dt">se =</span> se,
  <span class="dt">pvalue =</span> pvalue,
  <span class="dt">psignif =</span> <span class="fl">0.002</span>,
  <span class="dt">colour =</span> study,
  <span class="dt">shape =</span> study,
  <span class="dt">xlab =</span> <span class="st">"Odds ratio for incident type 2 diabetes (95% CI)</span><span class="ch">\n</span><span class="st">per 1−SD increment in metabolite concentration"</span>,
  <span class="dt">title =</span> <span class="st">"Amino acids"</span>,
  <span class="dt">logodds =</span> <span class="ot">TRUE</span>
) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span>(
    <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(23L, 21L, 21L, 21L, 21L),
    <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Meta-analysis"</span>, <span class="st">"NFBC-1997"</span>, <span class="st">"DILGOM"</span>, <span class="st">"FINRISK-1997"</span>, <span class="st">"YFS"</span>)
  )
<span class="co">#&gt; Scale for 'shape' is already present. Adding another scale for 'shape',</span>
<span class="co">#&gt; which will replace the existing scale.</span></code></pre></div>
<p><img src="ggforestplot_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Finally, the <code>ggforestplot</code> package offers a custom function that plots and prints in a 2-page pdf file all Nightingale blood biomarkers, namely <code><a href="../reference/plot_all_NG_biomarkers.html">plot_all_NG_biomarkers()</a></code>. It’s usage is straightforward.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Join the built-in association demo dataset with a variable that contains</span>
<span class="co"># the machine readable names of Nightingale biomarkers. (Note: if you</span>
<span class="co"># have built your association data frame using the Nightingale CSV result file, </span>
<span class="co"># then your data frame should already contain machine readable names.)</span>
df &lt;-
<span class="st">  </span>df_linear_associations <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(
    <span class="kw">select</span>(
      df_NG_biomarker_metadata,
      name,
      machine_readable_name
    ),
    <span class="dt">by =</span> <span class="st">"name"</span>)

<span class="co"># Print effect sizes for all Nightingale biomarkers in a custom 2-page pdf</span>
<span class="kw"><a href="../reference/plot_all_NG_biomarkers.html">plot_all_NG_biomarkers</a></span>(
  <span class="dt">df =</span> df,
  <span class="dt">machine_readable_name =</span> machine_readable_name,
  <span class="dt">estimate =</span> beta,
  <span class="dt">se =</span> se,
  <span class="dt">pvalue =</span> pvalue,
  <span class="dt">colour =</span> trait,
  <span class="dt">filename =</span> <span class="st">"biomarker_linear_associations.pdf"</span>,
  <span class="dt">xlab =</span> <span class="st">"1-SD increment in BMI</span><span class="ch">\n</span><span class="st">per 1-SD increment in biomarker concentration"</span>
)</code></pre></div>
<p>You may view the output of this function <a href="https://github.com/NightingaleHealth/ggforestplot/blob/master/vignettes/figures/biomarker_linear_associations.pdf">here</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#usage">Usage</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ilari Scheinin, Maria Kalimeri, Juuso Parkkinen, Emmi Tikkanen, Peter Würtz, Antti Kangas, <a href="https://nightingalehealth.com"><img src="NG_Logo.png" height="28" alt="Logo"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
